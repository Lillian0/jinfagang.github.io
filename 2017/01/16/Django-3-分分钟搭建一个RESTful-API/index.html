<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Jintian">
  <!-- Open Graph Data -->
  <meta property="og:title" content="Django 3 分分钟搭建一个RESTful API"/>
  <meta property="og:description" content="Just my blog" />
  <meta property="og:site_name" content="Jin Tian"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.comundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="Jin Tian" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>Jin Tian</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.dark.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-light.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">Django 3 分分钟搭建一个RESTful API</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="/about">
                  
                  About
                  
                </a>
              </li>
            
              <li>
                <a href="/tags">
                  
                  Tag
                  
                </a>
              </li>
            
              <li>
                <a href="/achievements">
                  
                  Achievements
                  
                </a>
              </li>
            
              <li>
                <a href="/resume">
                  
                  Resume
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/jinfagang">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:jinfagang19@163.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By Jintian</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-01-16</span>
            <span class="time">10:51:39</span>
          </span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/Django/">#Django</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h3 id="Django-restframework-简介"><a href="#Django-restframework-简介" class="headerlink" title="Django restframework 简介"></a>Django restframework 简介</h3><p>时间过得好快，不知不觉这就是Django系列教程的第三部分了，这部分我们将在一分钟之内用django的一个第三方框架-Django restframework搭建我们的第一个api。首先闲话不多说让我们先安装一下这个框架：<br><figure class="highlight cmake"><table><tr><td class="code"><pre><div class="line">sudo pip3 <span class="keyword">install</span> django-restframework</div></pre></td></tr></table></figure></p>
<p>ok，安装完之后能让我们新建一个project吧<br><figure class="highlight ebnf"><table><tr><td class="code"><pre><div class="line"><span class="attribute">django-admin startproject ara</span></div></pre></td></tr></table></figure></p>
<p>接着新建一个app：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">python3 manage<span class="selector-class">.py</span> startapp users</div></pre></td></tr></table></figure></p>
<p>ok这时候我们的项目结构应该是这样的：<br><figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">.</div><div class="line">├── ara</div><div class="line">│   ├── __init__<span class="selector-class">.py</span></div><div class="line">│   ├── settings<span class="selector-class">.py</span></div><div class="line">│   ├── urls<span class="selector-class">.py</span></div><div class="line">│   └── wsgi<span class="selector-class">.py</span></div><div class="line">└── users</div><div class="line">    ├── __init__<span class="selector-class">.py</span></div><div class="line">    ├── admin<span class="selector-class">.py</span></div><div class="line">    ├── apps<span class="selector-class">.py</span></div><div class="line">    ├── models<span class="selector-class">.py</span></div><div class="line">    ├── tests<span class="selector-class">.py</span></div><div class="line">    └── views.py</div></pre></td></tr></table></figure></p>
<p>ok，简单易懂，接着还是我们配置一下restframework吧</p>
<h3 id="Restframework配置"><a href="#Restframework配置" class="headerlink" title="Restframework配置"></a>Restframework配置</h3><p>配置这个框架请依照这个步骤来，缺一不可：</p>
<ul>
<li><p><strong>在settings.py中我们install一下</strong></p>
<figure class="highlight sml"><table><tr><td class="code"><pre><div class="line"><span class="type">INSTALLED_APPS</span> = [</div><div class="line">    <span class="symbol">'django</span>.contrib.admin',</div><div class="line">    <span class="symbol">'django</span>.contrib.auth',</div><div class="line">    <span class="symbol">'django</span>.contrib.contenttypes',</div><div class="line">    <span class="symbol">'django</span>.contrib.sessions',</div><div class="line">    <span class="symbol">'django</span>.contrib.messages',</div><div class="line">    <span class="symbol">'django</span>.contrib.staticfiles',</div><div class="line">    <span class="symbol">'users'</span>,</div><div class="line">    <span class="symbol">'rest_framework'</span></div><div class="line">]</div></pre></td></tr></table></figure>
</li>
<li><p><strong>在settings.py中添加这个</strong></p>
<figure class="highlight ada"><table><tr><td class="code"><pre><div class="line"># using rest_framework setting this line</div><div class="line">REST_FRAMEWORK = &#123;</div><div class="line">    # <span class="keyword">Use</span> Django<span class="symbol">'s</span> standard `django.contrib.auth` permissions,</div><div class="line">    # <span class="keyword">or</span> allow read-only <span class="keyword">access</span> <span class="keyword">for</span> unauthenticated users.</div><div class="line">    <span class="symbol">'DEFAULT_PERMISSION_CLASSES</span>': [</div><div class="line">        <span class="symbol">'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly</span>'</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ok，经过这个配置之后，我们就可以在项目中import restframework了。接下来我要向同志们展示一下这个东西到底有多么吊炸天！</p>
<h3 id="三步搞定一套API，增删改查！"><a href="#三步搞定一套API，增删改查！" class="headerlink" title="三步搞定一套API，增删改查！"></a>三步搞定一套API，增删改查！</h3><p>我说过只用三步，那我们就分三步来。</p>
<ul>
<li><strong>第1步：</strong> 当然是新建一个models</li>
</ul>
<p>二话不多说直接复制粘贴代码：<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Create your models here.</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    name: name of user,</div><div class="line">    gender: user's gender</div><div class="line">    wechat: user's wechat</div><div class="line">    """</div><div class="line">    name = models.CharField(max_length=<span class="number">100</span>, blank=<span class="keyword">False</span>)</div><div class="line">    gender = models.CharField(max_length=<span class="number">4</span>, blank=<span class="keyword">True</span>)</div><div class="line">    birthday = models.DateField(blank=<span class="keyword">True</span>)</div><div class="line">    portrait_url = models.CharField(max_length=<span class="number">100</span>, blank=<span class="keyword">True</span>)</div><div class="line">    home = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line">    phone = models.CharField(max_length=<span class="number">17</span>, blank=<span class="keyword">True</span>)</div><div class="line">    email = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line">    wechat = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line">    company = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line">    occupation = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line">    living_city = models.CharField(max_length=<span class="number">20</span>, blank=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.name</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>第2步：</strong> 在app下新建serializers.py，写入这些代码</li>
</ul>
<p>二话不多说直接复制粘贴代码：<br><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers, viewsets</div><div class="line"><span class="keyword">from</span> users.models <span class="keyword">import</span> User</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        model = User</div><div class="line">        fields = <span class="string">'__all__'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># ViewSets define the view behavior.</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></div><div class="line">    queryset = User.objects.all()</div><div class="line">    serializer_class = UsersSerializer</div></pre></td></tr></table></figure></p>
<p>在这里我们实现一个UsersSerializers以及一个UsersViewSet这两个类，这个序列化函数暂且不知道是干毛的，但是很显然这个函数的作用是把从数据库中查询的结果序列化为字符串。不过重点是这个ViewSet，这个东西就这么几行代码它就帮你实现好了增、删、改、查的所有功能。不是吹牛逼等一下我们来验证看看是不是。<br>你会惊奇的发现，有了这个ViewSet之后我们都不用写view.py了！！！！！</p>
<ul>
<li><strong>第3步：</strong> 配置urls<br>二话不多说直接复制粘贴代码：<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</div><div class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line"><span class="keyword">from</span> users.serializers <span class="keyword">import</span> UsersViewSet</div><div class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</div><div class="line"></div><div class="line">router = routers.DefaultRouter()</div><div class="line">router.register(<span class="string">r'api/v1/users'</span>, UsersViewSet)</div><div class="line"></div><div class="line">urlpatterns = [</div><div class="line">    url(<span class="string">r'^admin/'</span>, admin.site.urls),</div><div class="line">    url(<span class="string">r'^api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>, namespace=<span class="string">'rest_framework'</span>)),</div><div class="line">    url(<span class="string">r'^'</span>, include(router.urls))</div><div class="line">]</div></pre></td></tr></table></figure>
</li>
</ul>
<p>配置urls要用到restframework中的router这个类，这个是一个路由器，或者说是分发器，request的网址分发过来我发给哪个view处理就有他来决定，但是很显然这里并没有发给任何一个view，而是直接发给了一个ViewSet，这个ViewSet结合我们的serializer就可以实现我们的返回json或者接受json的全套功能！就是这么的屌！屌的爆炸！！<br>好吧，最后说一下urlpatterns里面的几个pattern，第一个是admin不需要多说，重点是最后一个我们include了router的urls，所以说你只需要按照router的网址来写即可，不过重点是router还实现了一个隐士查询也就是你可以加具体数字查询具体的detail。</p>
<h3 id="Django-restframework测试！"><a href="#Django-restframework测试！" class="headerlink" title="Django restframework测试！"></a>Django restframework测试！</h3><p>说了这么多来测试一下呗！！我们输入：<br><figure class="highlight awk"><table><tr><td class="code"><pre><div class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span><span class="regexp">/api/</span>v1<span class="regexp">/users</span></div></pre></td></tr></table></figure></p>
<p>看看返回的结果：<br><figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">HTTP <span class="number">200</span> OK</div><div class="line"><span class="string">Allow:</span> GET, POST, OPTIONS</div><div class="line">Content-<span class="string">Type:</span> application/json</div><div class="line"><span class="string">Vary:</span> Accept</div><div class="line"></div><div class="line">[</div><div class="line">    &#123;</div><div class="line">        <span class="string">"id"</span>: <span class="number">1</span>,</div><div class="line">        <span class="string">"name"</span>: <span class="string">"金天"</span>,</div><div class="line">        <span class="string">"gender"</span>: <span class="string">"男"</span>,</div><div class="line">        <span class="string">"birthday"</span>: <span class="string">"1993-12-11"</span>,</div><div class="line">        <span class="string">"portrait_url"</span>: <span class="string">"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1593523098,2479335990&amp;fm=116&amp;gp=0.jpg"</span>,</div><div class="line">        <span class="string">"home"</span>: <span class="string">"江西南昌"</span>,</div><div class="line">        <span class="string">"phone"</span>: <span class="string">"15116123160"</span>,</div><div class="line">        <span class="string">"email"</span>: <span class="string">"1195889656@qq.com"</span>,</div><div class="line">        <span class="string">"wechat"</span>: <span class="string">"jintianilveu"</span>,</div><div class="line">        <span class="string">"company"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"occupation"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"living_city"</span>: <span class="string">""</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">"id"</span>: <span class="number">2</span>,</div><div class="line">        <span class="string">"name"</span>: <span class="string">"Elgins"</span>,</div><div class="line">        <span class="string">"gender"</span>: <span class="string">"男"</span>,</div><div class="line">        <span class="string">"birthday"</span>: <span class="string">"1994-11-02"</span>,</div><div class="line">        <span class="string">"portrait_url"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"home"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"phone"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"email"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"wechat"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"company"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"occupation"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"living_city"</span>: <span class="string">""</span></div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>在网页中你可以直接测试POST PUT GET等方法，总是很牛逼有没有！！分分钟做一套API啊！！比java web快出了不知道多少倍！！！明天我们继续深入探测这个东西！！！！！</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Copyright <a target="_blank" href="https://github.com/jinfagang">Jintian</a>
          An Intelligent Scientist
          </p>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">DeepX</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

